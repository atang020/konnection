{"version":3,"sources":["main.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"main.js","sourcesContent":["$(document).ready(function () {\n\n  var genericFailMessage = 'Something went wrong! Please report this incident to technology@ucsdcki.org';\n\n  //region Ajax setup\n\n  $.ajaxSetup({\n    headers: {\n      'X-CSRF-TOKEN': $('meta[name=\"csrf-token\"]').attr('content')\n    }\n  });\n\n  //endregion\n\n  //region Homepage carousel configuration\n\n  $('.slider').slick({\n    autoplay: true\n  });\n\n  //endregion\n\n  //region Calendar plugin configuration\n\n  window.setEventColor = function(type_id) {\n\n    var color = '#999';\n\n    switch (type_id) {\n\n      //Service\n      case 1:\n        color = '#6DA592';\n        break;\n\n      // Social\n      case 2:\n        color = '#4A7B9D';\n        break;\n\n      // Committee\n      case 3:\n        color = '#93ACB5';\n        break;\n\n      // Kiwanis\n      case 4:\n        color = '#A898B3';\n        break;\n\n      // Fundraising\n      case 5:\n        color = '#759936';\n        break;\n\n      // Division/District\n      case 6:\n        color = '#CEB28A';\n        break;\n    }\n\n    return color;\n  }\n\n  $('.calendar').fullCalendar({\n    class: 'calendar',\n    height: 'auto',\n    columnFormat: {\n      month: 'dddd',    // Monday, Wednesday, etc\n      week: 'dddd, MMM dS', // Monday 9/7\n      day: 'dddd, MMM dS'  // Monday 9/7\n    },\n    buttonText: {\n      today: 'Today',\n      month: 'Month',\n      week: 'Week',\n      day: 'Day'\n    },\n    events: function(start, end, timezone, callback) {\n      $.ajax({\n        url: '/api/events',\n        dataType: 'json',\n        data: {\n          // our hypothetical feed requires UNIX timestamps\n          start: start.toISOString(),\n          end: end.toISOString()\n        },\n        success: function(doc) {\n          var events = [];\n\n          _.forEach(doc, function(event) {\n            events.push({\n              id: event.id,\n              title: event.title,\n              start: moment.tz(event.start_time, \"UTC\").tz(\"America/Los_Angeles\"), // Convert from server UTC to local\n              end: moment.tz(event.start_time, \"UTC\").tz(\"America/Los_Angeles\"),\n              url: '/events/' + event.slug,\n              backgroundColor: window.setEventColor(event.type_id),\n              borderColor: window.setEventColor(event.type_id)\n            });\n          });\n\n          callback(events);\n        }\n      });\n    }\n  });\n\n  //endregion\n\n  //region Event display and driver, writer, photographer buttons\n\n  function findSlug() {\n    var path = window.location.pathname;\n    return path.substr(path.lastIndexOf(\"/\") + 1);\n  }\n  \n  $('#register-btn').click(function(event) {\n    var self = $(this);\n    self.html('<i class=\"fa fa-circle-o-notch fa-spin\"></i> Signup');\n\n    // Register user\n    $.ajax({\n      type: 'POST',\n      url: '/api/events/'+findSlug()+'/registrations/create',\n      success: function() {\n        // Change button\n        self.attr('id','unregister-btn');\n        self.html('<i class=\"fa fa-close\"></i> Signup');\n      },\n      error: function() {\n        self.html('<i class=\"fa fa-check\"></i> Signup');\n        alert('An error occurred and we were unable to sign you up for the event!');\n      }\n    });\n  });\n\n  $('#unregister-btn').click(function(event) {\n    var self = $(this);\n    self.html('<i class=\"fa fa-circle-o-notch fa-spin\"></i> Signup');\n\n    // Unregister user\n    $.ajax({\n      url: '/api/events/'+findSlug()+'/registrations/self',\n      type: 'DELETE',\n      success: function() {\n        // Change button\n        self.attr('id','register-btn');\n        self.html('<i class=\"fa fa-check\"></i> Signup');\n      },\n      error: function() {\n        self.html('<i class=\"fa fa-close\"></i> Signup');\n        alert('An error occurred and we were unable to remove your signup for the event!');\n      }\n    });\n  });\n\n  $('#registerGuest').submit(function(event) {\n    event.preventDefault();\n\n    var $form = $(this);\n\n    var data = {\n      first_name: $form.find( \"input[name='firstName']\" ).val(),\n      last_name: $form.find( \"input[name='lastName']\" ).val(),\n      phone: $form.find( \"input[name='phone']\" ).val()\n    };\n\n    $.post('/api/events/'+findSlug()+'/registrations/create', data);\n\n    $('#guestRegistration').remove();\n  });\n\n  window.updateChair = function(id) {\n\n    console.log('slug is: ' + findSlug() + ' and id is: ' + id);\n\n    $.ajax({\n      url: '/api/events/' + findSlug(),\n      type: 'PATCH',\n      data: {\n        chair_id: id\n      }\n    })\n      .fail(function() {\n        alert(genericFailMessage);\n      })\n      .done(function(data) {\n        console.log('chair updated!');\n      });\n  }\n\n  $('#chair-event-btn').click(function(event) {\n    console.log('chair event button clicked');\n\n    var urlField = $('.chair.avatar').find('img');\n    var nameField = $('.chair.avatar').find('.name');\n    var infoField = $('.chair.avatar').find('.info');\n\n    $.get('/users/current', function(data) {\n      var currentUser = $.parseJSON(data);\n\n      var name = currentUser.first_name + ' ' + currentUser.last_name;\n      var phone = currentUser.phone;\n\n      nameField.text(name);\n      phone ? infoField.text(phone) : infoField.text('');\n\n      window.updateChair(currentUser.id);\n    })\n      .fail(function() {\n        alert(genericFailMessage);\n      });\n  });\n\n  $('#drive-btn').click(function(event) {\n\n    // Register user\n    $.ajax({\n      url: '/api/events/'+findSlug()+'/registrations/self',\n      type: 'PATCH',\n      data: {\n        driver_status: 1\n      }\n    });\n\n    // Change button\n    var self = $(this);\n    self.prop('disabled', true);\n  });\n\n  $('#photograph-btn').click(function(event) {\n    // Register user\n    $.ajax({\n      url: '/api/events/'+findSlug()+'/registrations/self',\n      type: 'PATCH',\n      data: {\n        photographer_status: 1\n      }\n    });\n\n    // Change button\n    var self = $(this);\n    self.prop('disabled', true);\n  });\n\n  $('#write-btn').click(function(event) {\n    // Register user\n    $.ajax({\n      url: '/api/events/'+findSlug()+'/registrations/self',\n      type: 'PATCH',\n      data: {\n        writer_status: 1\n      }\n    });\n\n    // Change button\n    var self = $(this);\n    self.prop('disabled', true);\n  });\n\n  //endregion\n\n  //region Date and time picker configuration\n\n  $('.datetime').datetimepicker({\n    format: 'l, F j, Y g:i A',    // Expresses date in readable format.\n    step: 30                      // Sets times in timepicker at increments of 30 minutes.\n  });\n\n  //endregion\n\n  //region Popup plugin configuration and customization\n\n  $('.search-popup-link').magnificPopup({\n    type: 'inline',\n    closeBtnInside: false,\n\n    callbacks: {\n      open: function() {\n\n        // Hackish autofocus; can't set autofocus HTML attribute and there is no afterOpen callback.\n        setTimeout(function() {\n          $('#search-input').focus();\n        }, 500);\n      },\n\n      beforeClose: function() {\n        $('#not-listed').remove();\n        $('#search-results').removeClass('attendee-select');\n      }\n    },\n\n    removalDelay: 500,\n    mainClass: 'mfp-move-horizontal'\n  });\n\n  // Check classes to customize popup\n  $('.search-popup-link').click(function() {\n\n    if ($(this).hasClass('user-optional')) {\n      $('#search-input').after('<a href=\"#\" id=\"not-listed\">Not a paid member?</a>');\n      $('#search-results').addClass('attendee-select');\n    }\n    else if ($(this).hasClass('user-not-optional')) {\n      $('#search-results').addClass('chair-select');\n    }\n  });\n\n  //endregion\n\n  //region Search functions and popup actions\n\n  var timeoutID;\n\n  window.searchUsers = function() {\n\n    var searchAndDisplayResults = function() {\n\n      // Gets user input.\n      var input = $('#search-input').val();\n\n      if (input.length > 0) {\n\n        // Posts to UsersController@search with user input and fills in div with results.\n        $.post('/users/search', {input: input}, function(markup) {\n          $('#search-results').html(markup);\n        })\n      }\n    };\n\n    // Finds results when user finishes typing.\n    setTimeout(searchAndDisplayResults, 500);\n  }\n\n  window.resetTimer = function() {\n    clearTimeout(timeoutID);\n  }\n\n  /**\n   * Sets chair name, image, and hidden form input with relevant\n   *\n   * @param id\n   * @param url\n   * @param name\n   */\n  window.setChair = function(id, url, name) {\n\n    $('.chair-field').val(id);\n\n    $('.avatar > p').html(function() {\n      return '<strong>Event Chair: </strong>' + name;\n    })\n\n    $('.avatar > img').attr('src', url);\n  }\n\n  /**\n   * Adds another row to member attendee table.\n   *\n   * @param id\n   * @param name\n   */\n  window.addAttendeeRow = function(id, name) {\n\n\n    console.log('adding attendee row');\n\n    $('#member-attendance-section').find('table tr:last').after('' +\n      '<tr>' +\n        '<input class=\"attendee-field\" name=\"user_id[]\" type=\"hidden\" value=' + id + '>' +\n        '<input  name=\"name[]\" type=\"hidden\" value=' + name + '>' +\n        '<td>' + name + '</td>' +\n        '<td><input name=\"service_hours[]\" type=\"number\" value=\"0\"></td>' +\n        '<td><input name=\"planning_hours[]\" type=\"number\" value=\"0\"></td>' +\n        '<td><input name=\"traveling_hours[]\" type=\"number\" value=\"0\"></td>' +\n        '<td><input name=\"admin_hours[]\" type=\"number\" value=\"0\"></td>' +\n        '<td><input name=\"social_hours[]\" type=\"number\" value=\"0\"></td>' +\n        '<td><input name=\"mileage[]\" type=\"number\" value=\"0\"></td>' +\n        '<td><a href=\"#\" class=\"remove-registration-button\"><div class=\"button emphasis\"><i class=\"fa fa-times\"></i></div></a></td>' +\n      '</tr>');\n  }\n\n  // Adds new row for attendee with empty form fields.\n  $('.search-popup').on('click', '#not-listed', function(event) {\n    event.preventDefault();\n\n    console.log('insert empty form values');\n\n    $.magnificPopup.close();\n\n    $('#member-attendance-section').find('table tr:last').after('' +\n      '<tr>' +\n        '<input name=\"user_id[]\" type=\"hidden\" value=null>' +\n        '<td><input type=\"text\" name=\"name[]\"></td>' +\n        '<td><input type=\"number\" name=\"service_hours[]\" value=\"0\"></td>' +\n        '<td><input type=\"number\" name=\"planning_hours[]\" value=\"0\"></td>' +\n        '<td><input type=\"number\" name=\"traveling_hours[]\" value=\"0\"></td>' +\n        '<td><input type=\"number\" name=\"admin_hours[]\" value=\"0\"></td>' +\n        '<td><input type=\"number\" name=\"social_hours[]\" value=\"0\"></td>' +\n        '<td><input type=\"number\" name=\"mileage[]\" value=\"0\"></td>' +\n        '<td><a href=\"#\" class=\"remove-registration-button\"><div class=\"button emphasis\"><i class=\"fa fa-times\"></i></div></a></td>' +\n      '</tr>');\n  });\n\n  // Searches users only when keydown events have finished (when user finishes typing)\n  $('#search-input').keydown(window.searchUsers);\n  $('#search-input').keyup(window.resetTimer);\n\n  // Popup loaded with AJAX, so cannot use jQuery native click() function\n  $('#search-results').on('click', 'a', function(event) {\n    event.preventDefault();\n\n    // Updates UI with info from search result\n    var id = $(this).find('.result-description').attr('userId');\n    var url = $(this).find('.result-avatar > img').attr('src');\n    var name = $(this).find('.result-description > div:first-child').text();\n\n    // For adding attendees to member attendance table\n    if ($('#search-results').hasClass('attendee-select')) {\n      console.log('add new row to member attendance table')\n      window.addAttendeeRow(id, name);\n    }\n\n    // For selecting event chair\n    else if ($('#search-results').hasClass('chair-select')) {\n      console.log('change chair selection');\n      window.setChair(id, url, name);\n    }\n\n    $.magnificPopup.close();\n  });\n\n  //endregion\n\n  //region CERF form functions\n\n  $('#attendance-table').on('click', '.remove-registration-button > div', function(event) {\n    console.log('anchored click event to handle');\n    $(this).parents().eq(2).remove();\n\n    event.preventDefault();\n  });\n\n  $('#kiwanis-attendance-section').on('click', '.remove-kiwanis-attendee-button > div', function(event) {\n    console.log('remove kiwanis attendee');\n    $(this).parents().eq(2).remove();\n\n    event.preventDefault();\n  });\n\n  $('#kiwanis-attendance-section').on('click', '.add-kiwanis-attendee-button > div', function(event) {\n    console.log('add kiwanis attendee');\n\n    var lastRow = $('#kiwanis-attendance-section').find('table tr:last');\n\n    lastRow.after('' +\n      '<tr>' +\n        '<td><input name=\"kiwanis_club_name[]\" type=\"text\" class=\"kiwanis-club-name\"></td>' +\n        '<td><input name=\"num_members[]\" type=\"number\"></td>' +\n        '<td><a href=\"#\" class=\"remove-kiwanis-attendee-button\"><div class=\"button emphasis\"><i class=\"fa fa-times\"></i></div></a></td>' +\n      '</tr>');\n\n    event.preventDefault();\n  });\n\n  //endregion\n\n  //region Miscellaneous\n\n  $('.editor').editable({inlineMode: false});\n  $('#featuredEventEditor').editable({maxCharacters: 160, inlineMode: false});\n\n  //endregion\n\n});\n"],"sourceRoot":"/source/"}